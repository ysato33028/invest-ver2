<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投資回収シミュレーション</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body onload="loadFormData()">
    <div class="container">
        <div class="column">
            <h2>投資・物件条件</h2>
            <div class="form-section">
              <div class="section-title">設備投資
                 <btn-s onclick="location.href='investment-input.html'"><p>入力!</p></btn-s>
              </div>
                <div class="form-group">
                    <label for="total-investment-input">設備投資合計:</label>
                    <span id="total-investment-input">0</span>
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">減価償却費</div>
                <div class="form-group">
                    <label for="depreciation">償却月数:</label>
                    <input type="number" id="depreciation" value="60" oninput="saveFormData()">
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">月額賃料</div>
                <div class="form-group">
                    <label for="rent">施設使用料:</label>
                    <input type="number" id="rent" value="2000000" oninput="saveFormData()">
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">拠点契約面積</div>
                <div class="form-group">
                    <label for="area">契約面積（坪）:</label>
                    <input type="number" id="area" value="50" oninput="saveFormData()">
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">契約期間</div>
                <div class="form-group">
                    <label for="duration">契約期間（年）:</label>
                    <input type="number" id="duration" value="10" oninput="saveFormData()">
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">月間運営費用</div>
                <div class="form-group">
                    <label for="personnel">人件費計:</label>
                    <input type="number" id="personnel" value="1700000" oninput="saveFormData()">
                </div>
                <div class="form-group">
                    <label for="promotion">販売促進費計:</label>
                    <input type="number" id="promotion" value="1000000" oninput="saveFormData()">
                </div>
                <div class="form-group">
                    <label for="equipment-cost">設備費計:</label>
                    <input type="number" id="equipment-cost" value="2500000" oninput="saveFormData()">
                </div>
                <div class="form-group">
                    <label for="general">一般費用計:</label>
                    <input type="number" id="general" value="1500000" oninput="saveFormData()">
                </div>
            </div>
            <div class="form-section">
                <div class="section-title">想定年間売上</div>
                <div class="form-group">
                    <label for="annual-sales">年間売上:</label>
                    <input type="number" id="annual-sales" value="250000000" oninput="saveFormData()">
                </div>
                <div class="form-group">
                    <label for="gross-margin-rate">荒利率（％）:</label>
                    <input type="number" id="gross-margin-rate" value="45.1" oninput="saveFormData()">
                </div>
            </div>
        </div>

        <div class="column">
            <h2>投資回収シミュレーション</h2>
            <div class="form-section">
                <div class="section-title">勘定項目</div>
                <div class="form-group">
                    <label>売上高:</label>
                    <span id="sales">0</span>
                </div>
                <div class="form-group">
                    <label>売上原価:</label>
                    <span id="cost-of-sales">0</span>
                </div>
                <div class="form-group">
                    <label>売上総利益:</label>
                    <span id="gross-profit">0</span>
                </div>
                <div class="form-group">
                    <label>人件費計:</label>
                    <span id="total-personnel">0</span>
                </div>
                <div class="form-group">
                    <label>販売促進費計:</label>
                    <span id="total-promotion">0</span>
                </div>
                <div class="form-group">
                    <label>設備費計:</label>
                    <span id="total-equipment-cost">0</span>
                </div>
                <div class="form-group">
                    <label>うち減価償却費:</label>
                    <span id="annual-depreciation">0</span>
                </div>
                <div class="form-group">
                    <label>販売費一般管理費合計:</label>
                    <span id="total-sga">0</span>
                </div>
                <div class="form-group">
                    <label>営業利益:</label>
                    <span id="operating-profit">0</span>
                </div>
                <div class="form-group">
                    <label>税金概算（40％）:</label>
                    <span id="tax">0</span>
                </div>
                <div class="form-group">
                    <label>税引後純利益:</label>
                    <span id="net-income">0</span>
                </div>
                <div class="form-group">
                    <label>キャッシュフロー:</label>
                    <span id="cash-flow">0</span>
                </div>
                <div class="form-group">
                    <label>投資回収期間（ヶ月）:</label>
                    <span id="payback-period">0</span>
                </div>
                <div class="form-group">
                    <button id="export-ppt-button" class="input-button">PPTエクスポート</button>
                    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.6.0/dist/pptxgen.min.js"></script>
                </div>
            </div>
        </div>
    </div>
    <button onclick="calculate()">計算する</button>
    <script src="app.js"></script>
    <script>
        window.onload = function() {
            loadFormData();
            const totalInvestment = parseFloat(localStorage.getItem('totalInvestment')) || 0;
            document.getElementById('total-investment-input').textContent = totalInvestment.toLocaleString();
        };

        document.getElementById('export-ppt-button').addEventListener('click', function() {
            const sales = document.getElementById('sales').textContent;
            const costOfSales = document.getElementById('cost-of-sales').textContent;
            const grossProfit = document.getElementById('gross-profit').textContent;
            const personnel = document.getElementById('total-personnel').textContent;
            const promotion = document.getElementById('total-promotion').textContent;
            const equipmentCost = document.getElementById('total-equipment-cost').textContent;
            const annualDepreciation = document.getElementById('annual-depreciation').textContent;
            const totalSGA = document.getElementById('total-sga').textContent;
            const operatingProfit = document.getElementById('operating-profit').textContent;
            const tax = document.getElementById('tax').textContent;
            const netIncome = document.getElementById('net-income').textContent;
            const cashFlow = document.getElementById('cash-flow').textContent;
            const paybackPeriod = document.getElementById('payback-period').textContent;

            const pptx = new PptxGenJS();
            const slide = pptx.addSlide();
            slide.addText('投資回収シミュレーション', { x: 1, y: 0.5, fontSize: 24, bold: true, fontFace: 'メイリオ'  });

            const tableData = [
                [{ text: '勘定科目', options: { fill: { color: '45B39D' }, fontFace: 'メイリオ' } }, { text: '金額', options: { fill: { color: '45B39D' }, fontFace: 'メイリオ' } }],
                [{ text: '売上高', options: { fontFace: 'メイリオ' } }, { text: sales, options: { fontFace: 'メイリオ' } }],
                [{ text: '売上原価', options: { fontFace: 'メイリオ' } }, { text: costOfSales, options: { fontFace: 'メイリオ' } }],
                [{ text: '売上総利益', options: { fontFace: 'メイリオ' } }, { text: grossProfit, options: { fontFace: 'メイリオ' } }],
                [{ text: '人件費計', options: { fontFace: 'メイリオ' } }, { text: personnel, options: { fontFace: 'メイリオ' } }],
                [{ text: '販売促進費計', options: { fontFace: 'メイリオ' } }, { text: promotion, options: { fontFace: 'メイリオ' } }],
                [{ text: '設備費計', options: { fontFace: 'メイリオ' } }, { text: equipmentCost, options: { fontFace: 'メイリオ' } }],
                [{ text: 'うち減価償却費', options: { fontFace: 'メイリオ' } }, { text: annualDepreciation, options: { fontFace: 'メイリオ' } }],
                [{ text: '販売費一般管理費合計', options: { fontFace: 'メイリオ' } }, { text: totalSGA, options: { fontFace: 'メイリオ' } }],
                [{ text: '営業利益', options: { fontFace: 'メイリオ' } }, { text: operatingProfit, options: { fontFace: 'メイリオ' } }],
                [{ text: '税金概算（40％）', options: { fontFace: 'メイリオ' } }, { text: tax, options: { fontFace: 'メイリオ' } }],
                [{ text: '税引後純利益', options: { fontFace: 'メイリオ' } }, { text: netIncome, options: { fontFace: 'メイリオ' } }],
                [{ text: 'キャッシュフロー', options: { fontFace: 'メイリオ' } }, { text: cashFlow, options: { fontFace: 'メイリオ' } }],
                [{ text: '投資回収期間（ヶ月）', options: { fontFace: 'メイリオ' } }, { text: paybackPeriod, options: { fontFace: 'メイリオ' } }]
            ];

            slide.addTable(tableData, { x: 0.5, y: 1.5, w: 8.5, border: { pt: 1, color: '000000' }, fontFace: 'メイリオ'  });

            pptx.writeFile('投資回収シミュレーション.pptx');
        });
    </script>
</body>
</html>
